# ==============================================================================
# ZeroDay CVE Tracker - Backend Configuration
# ==============================================================================
# Copy this file to .env and configure values for your environment
# Never commit .env to version control!
# ==============================================================================

# ==============================================================================
# SERVER CONFIGURATION
# ==============================================================================

# Port number for the Express server
# Default: 5000
PORT=5000

# Application environment
# Options: development, production, test
# Default: development
# - development: Verbose logging, detailed errors, permissive CORS
# - production: Minimal logging, generic errors, strict CORS
# - test: Used for automated testing
NODE_ENV=development

# ==============================================================================
# DATABASE CONFIGURATION
# ==============================================================================

# MongoDB connection string
# Format: mongodb://[username:password@]host[:port]/database[?options]
# Examples:
#   Local: mongodb://localhost:27017/zeroday
#   Atlas: mongodb+srv://username:password@cluster.mongodb.net/zeroday
#   With auth: mongodb://admin:password@localhost:27017/zeroday?authSource=admin
# Default: mongodb://localhost:27017/zeroday
MONGODB_URI=mongodb://localhost:27017/zeroday

# MongoDB connection pool size
# Minimum number of connections to maintain
# Default: 2
DB_POOL_MIN=2

# Maximum number of connections in the pool
# Default: 10
DB_POOL_MAX=10

# Connection timeout in milliseconds
# Default: 30000 (30 seconds)
DB_CONNECT_TIMEOUT=30000

# ==============================================================================
# EXTERNAL API KEYS
# ==============================================================================

# NVD (National Vulnerability Database) API Key
# Get your key at: https://nvd.nist.gov/developers/request-an-api-key
# Without key: 5 requests per 30 seconds
# With key: 50 requests per 30 seconds
# Leave empty if not available
NVD_API_KEY=

# EPSS API Key (currently not required by FIRST.org)
# EPSS API is free and doesn't require authentication
# This is a placeholder for future use
EPSS_API_KEY=

# OSV.dev API Key (currently not required)
# OSV.dev API is free and doesn't require authentication
# This is a placeholder for future use
OSV_API_KEY=

# ==============================================================================
# RATE LIMITING CONFIGURATION
# ==============================================================================

# Global rate limit window in milliseconds
# Default: 900000 (15 minutes)
RATE_LIMIT_WINDOW_MS=900000

# Maximum requests per window for general endpoints
# Default: 100
RATE_LIMIT_MAX_REQUESTS=100

# Maximum sync requests per window
# Default: 1 (one sync every 5 minutes)
SYNC_RATE_LIMIT=1

# Maximum search requests per minute
# Default: 30
SEARCH_RATE_LIMIT=30

# Maximum export requests per 5 minutes
# Default: 10
EXPORT_RATE_LIMIT=10

# Whitelist IP addresses (comma-separated)
# These IPs bypass rate limiting
# Example: 127.0.0.1,192.168.1.100
RATE_LIMIT_WHITELIST=

# Use Redis for distributed rate limiting
# Requires REDIS_URL to be configured
# Default: false
USE_REDIS=false

# ==============================================================================
# DATA SYNC CONFIGURATION
# ==============================================================================

# Enable automatic CVE synchronization via cron jobs
# Default: true
AUTO_SYNC_ENABLED=true

# Sync interval in hours (for incremental sync)
# Default: 6
SYNC_INTERVAL_HOURS=6

# Number of days to look back for incremental sync
# Default: 7
SYNC_DAYS_BACK=7

# Enable EPSS score updates
# Default: true
SYNC_EPSS_ENABLED=true

# Enable CISA KEV catalog updates
# Default: true
SYNC_KEV_ENABLED=true

# Maximum CVEs to sync in one batch
# Default: 1000
SYNC_BATCH_SIZE=1000

# ==============================================================================
# LOGGING CONFIGURATION
# ==============================================================================

# Log level
# Options: error, warn, info, debug, trace
# Default: info
# - error: Only log errors
# - warn: Log warnings and errors
# - info: Log general information (recommended)
# - debug: Log detailed debugging information
# - trace: Log everything (very verbose)
LOG_LEVEL=info

# Log directory path
# Logs will be stored in daily files (e.g., info-2026-01-10.log)
# Default: ./logs
LOG_DIR=./logs

# Enable logging to files
# Default: false (console only in development)
LOG_TO_FILE=false

# Enable request/response logging
# Logs all HTTP requests with method, URL, status, duration
# Default: true
ENABLE_REQUEST_LOGGING=true

# Log retention in days
# Automatically delete logs older than this
# Default: 30
LOG_RETENTION_DAYS=30

# ==============================================================================
# CORS CONFIGURATION
# ==============================================================================

# Allowed origins for CORS (comma-separated)
# In development, localhost origins are automatically allowed
# In production, only these origins will be accepted
# Examples:
#   http://localhost:3000,http://localhost:5173
#   https://zeroday.dev,https://www.zeroday.dev
# Default: http://localhost:3000,http://localhost:3001
CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# Allow credentials (cookies, authorization headers) in CORS
# Default: true
CORS_CREDENTIALS=true

# CORS preflight cache duration in seconds
# Default: 86400 (24 hours)
CORS_MAX_AGE=86400

# ==============================================================================
# CACHE CONFIGURATION
# ==============================================================================

# Enable in-memory caching
# Default: true
ENABLE_CACHE=true

# Cache TTL (Time To Live) in seconds
# Default: 3600 (1 hour)
CACHE_TTL_SECONDS=3600

# EPSS cache TTL in hours
# Default: 24
EPSS_CACHE_TTL_HOURS=24

# KEV cache TTL in hours
# Default: 24
KEV_CACHE_TTL_HOURS=24

# NVD cache TTL in hours
# Default: 1
NVD_CACHE_TTL_HOURS=1

# ==============================================================================
# FEATURE FLAGS
# ==============================================================================

# Enable cron jobs for automated tasks
# Default: true
ENABLE_CRON_JOBS=true

# Enable WebSocket support for real-time updates
# Default: false (not implemented yet)
ENABLE_WEBSOCKETS=false

# Enable API documentation (Swagger)
# Default: true in development, false in production
ENABLE_API_DOCS=true

# Enable health check endpoint
# Default: true
ENABLE_HEALTH_CHECK=true

# Enable metrics collection (Prometheus)
# Default: false
ENABLE_METRICS=false

# ==============================================================================
# EXTERNAL SERVICES
# ==============================================================================

# Redis URL for caching and rate limiting
# Format: redis://[username:password@]host[:port][/database]
# Examples:
#   Local: redis://localhost:6379
#   With auth: redis://default:password@localhost:6379
#   Redis Cloud: redis://username:password@redis-12345.cloud.redislabs.com:12345
# Default: redis://localhost:6379
REDIS_URL=redis://localhost:6379

# Redis password (if required)
REDIS_PASSWORD=

# Redis database number
# Default: 0
REDIS_DB=0

# ==============================================================================
# EMAIL CONFIGURATION (Optional - for alerts and notifications)
# ==============================================================================

# SMTP server hostname
# Examples: smtp.gmail.com, smtp.sendgrid.net
SMTP_HOST=

# SMTP server port
# Common ports: 587 (TLS), 465 (SSL), 25 (unencrypted)
# Default: 587
SMTP_PORT=587

# SMTP username (usually your email address)
SMTP_USER=

# SMTP password or API key
SMTP_PASSWORD=

# Use TLS for SMTP connection
# Default: true
SMTP_USE_TLS=true

# Email address to send notifications from
# Example: noreply@zeroday.dev
EMAIL_FROM=

# Email addresses for alerts (comma-separated)
# Example: admin@example.com,security@example.com
ALERT_EMAIL_TO=

# ==============================================================================
# SECURITY CONFIGURATION
# ==============================================================================

# JWT secret key for token signing
# IMPORTANT: Change this to a random string in production!
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
# Default: your-secret-key-here (INSECURE - CHANGE THIS!)
JWT_SECRET=your-secret-key-here

# JWT token expiration time
# Examples: 1h, 24h, 7d, 30d
# Default: 24h
JWT_EXPIRES_IN=24h

# API key header name
# The HTTP header used for API key authentication
# Default: X-API-Key
API_KEY_HEADER=X-API-Key

# Valid API keys (comma-separated)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
# Example: abc123def456,xyz789uvw012
API_KEYS=

# Enable API key authentication
# Default: false (optional authentication)
REQUIRE_API_KEY=false

# Bcrypt salt rounds for password hashing
# Higher = more secure but slower
# Default: 10
BCRYPT_SALT_ROUNDS=10

# ==============================================================================
# MONITORING AND OBSERVABILITY
# ==============================================================================

# Application name for logging and monitoring
# Default: zeroday-cve-tracker
APP_NAME=zeroday-cve-tracker

# Application version (automatically set from package.json if not specified)
APP_VERSION=1.0.0

# Sentry DSN for error tracking (optional)
# Get from: https://sentry.io
SENTRY_DSN=

# Sentry environment
# Default: development
SENTRY_ENVIRONMENT=development

# Enable performance monitoring
# Default: false
ENABLE_PERFORMANCE_MONITORING=false

# ==============================================================================
# ADVANCED CONFIGURATION
# ==============================================================================

# Request body size limit
# Default: 10mb
BODY_LIMIT=10mb

# Request timeout in milliseconds
# Default: 30000 (30 seconds)
REQUEST_TIMEOUT=30000

# Enable compression (gzip)
# Default: true
ENABLE_COMPRESSION=true

# Trust proxy headers (X-Forwarded-For, etc.)
# Set to true if behind a reverse proxy (nginx, Apache)
# Default: false
TRUST_PROXY=false

# Number of proxy hops to trust
# Useful when behind multiple proxies
# Default: 1
TRUST_PROXY_HOPS=1

# Graceful shutdown timeout in milliseconds
# How long to wait for requests to complete before forcing shutdown
# Default: 30000 (30 seconds)
GRACEFUL_SHUTDOWN_TIMEOUT=30000

# ==============================================================================
# CRON JOB SCHEDULES (Advanced)
# ==============================================================================

# Cron expression for recent CVE sync
# Default: 0 */6 * * * (every 6 hours)
# Format: minute hour day month day-of-week
CRON_SYNC_CVE=0 */6 * * *

# Cron expression for KEV catalog update
# Default: 0 */12 * * * (every 12 hours)
CRON_UPDATE_KEV=0 */12 * * *

# Cron expression for log cleanup
# Default: 0 0 * * * (daily at midnight)
CRON_CLEANUP_LOGS=0 0 * * *

# Cron expression for daily report
# Default: 0 8 * * * (daily at 8 AM)
CRON_DAILY_REPORT=0 8 * * *

# Cron expression for health check
# Default: */5 * * * * (every 5 minutes)
CRON_HEALTH_CHECK=*/5 * * * *

# ==============================================================================
# NOTES
# ==============================================================================
#
# 1. Environment Variables Priority:
#    - System environment variables override .env values
#    - Use .env for local development
#    - Use environment variables for production deployment
#
# 2. Security Best Practices:
#    - Never commit .env file to version control
#    - Use strong, unique values for JWT_SECRET and API_KEYS
#    - Enable HTTPS in production
#    - Use environment-specific configurations
#    - Rotate secrets regularly
#
# 3. Performance Tips:
#    - Enable Redis for distributed caching and rate limiting
#    - Adjust DB_POOL_MAX based on your load
#    - Tune CACHE_TTL_SECONDS based on data freshness requirements
#    - Monitor and adjust rate limits as needed
#
# 4. MongoDB Atlas Setup:
#    - Create a free cluster at https://www.mongodb.com/cloud/atlas
#    - Whitelist your IP address
#    - Create a database user
#    - Get connection string from Atlas dashboard
#
# 5. Getting API Keys:
#    - NVD API Key: https://nvd.nist.gov/developers/request-an-api-key
#    - Approval usually takes 1-2 business days
#    - Keep your API keys secure and never share them
#
# ==============================================================================